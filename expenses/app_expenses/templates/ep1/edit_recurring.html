{% extends 'ep1/base.html' %} {% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">
          <i class="fas fa-edit me-2"></i>Sửa Chi Tiêu Định Kỳ
        </h4>
      </div>
      <div class="card-body p-4">
        <form method="post">
          {% csrf_token %}

          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold"
                >{{ form.name.label }}</label
              >
              {{ form.name }} {% if form.name.errors %}
              <div class="text-danger small mt-1">{{ form.name.errors }}</div>
              {% endif %}
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold"
                >{{ form.amount.label }}</label
              >
              {{ form.amount }} {% if form.amount.errors %}
              <div class="text-danger small mt-1">{{ form.amount.errors }}</div>
              {% endif %}
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold"
                >{{ form.category.label }}</label
              >
              {{ form.category }} {% if form.category.errors %}
              <div class="text-danger small mt-1">
                {{ form.category.errors }}
              </div>
              {% endif %}
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold"
                >{{ form.frequency.label }}</label
              >
              {{ form.frequency }} {% if form.frequency.errors %}
              <div class="text-danger small mt-1">
                {{ form.frequency.errors }}
              </div>
              {% endif %}
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold"
                >{{ form.start_date.label }}</label
              >
              {{ form.start_date }} {% if form.start_date.errors %}
              <div class="text-danger small mt-1">
                {{ form.start_date.errors }}
              </div>
              {% endif %}
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label fw-semibold"
                >{{ form.end_date.label }} (Tùy chọn)</label
              >
              {{ form.end_date }} {% if form.end_date.errors %}
              <div class="text-danger small mt-1">
                {{ form.end_date.errors }}
              </div>
              {% endif %}
            </div>

            <div class="col-12 mb-3">
              <label class="form-label fw-semibold"
                >{{ form.description.label }}</label
              >
              {{ form.description }} {% if form.description.errors %}
              <div class="text-danger small mt-1">
                {{ form.description.errors }}
              </div>
              {% endif %}
            </div>

            <div class="col-12 mb-3">
              <div class="form-check">
                {{ form.is_active }}
                <label
                  class="form-check-label"
                  for="{{ form.is_active.id_for_label }}"
                >
                  {{ form.is_active.label }}
                </label>
              </div>
            </div>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save me-2"></i>Cập Nhật
            </button>
            <a href="{% url 'ep1:recurring_list' %}" class="btn btn-secondary">
              <i class="fas fa-times me-2"></i>Hủy
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  // Format số tiền với dấu phẩy
  document.addEventListener("DOMContentLoaded", function () {
    const amountInput = document.querySelector('input[name="amount"]');

    function formatNumber(value) {
      value = value.replace(/[^\d]/g, "");
      return value.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    if (amountInput) {
      // Format giá trị ban đầu nếu có
      if (amountInput.value) {
        amountInput.value = formatNumber(amountInput.value);
      }

      // Format khi nhập
      amountInput.addEventListener("input", function () {
        this.value = formatNumber(this.value);
      });

      // Loại bỏ dấu phẩy trước khi submit
      amountInput.closest("form").addEventListener("submit", function () {
        amountInput.value = amountInput.value.replace(/,/g, "");
      });
    }
  });
</script>
{% endblock %}
