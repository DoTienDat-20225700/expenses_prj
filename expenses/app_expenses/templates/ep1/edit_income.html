{% extends 'ep1/base.html' %} {% block content %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0"><i class="fas fa-edit me-2"></i>Sửa Thu Nhập</h4>
      </div>
      <div class="card-body p-4">
        <form method="post">
          {% csrf_token %}

          <div class="mb-3">
            <label class="form-label fw-semibold"
              >{{ form.amount.label }}</label
            >
            {{ form.amount }} {% if form.amount.errors %}
            <div class="text-danger small mt-1">{{ form.amount.errors }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold"
              >{{ form.source.label }}</label
            >
            {{ form.source }} {% if form.source.errors %}
            <div class="text-danger small mt-1">{{ form.source.errors }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">{{ form.date.label }}</label>
            {{ form.date }} {% if form.date.errors %}
            <div class="text-danger small mt-1">{{ form.date.errors }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold"
              >{{ form.description.label }}</label
            >
            {{ form.description }} {% if form.description.errors %}
            <div class="text-danger small mt-1">
              {{ form.description.errors }}
            </div>
            {% endif %}
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save me-2"></i>Cập Nhật
            </button>
            <a href="{% url 'ep1:income_list' %}" class="btn btn-secondary">
              <i class="fas fa-times me-2"></i>Hủy
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  // Format số tiền với dấu phẩy
  document.addEventListener("DOMContentLoaded", function () {
    const amountInput = document.querySelector('input[name="amount"]');

    function formatNumber(value) {
      value = value.replace(/[^\d]/g, "");
      return value.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    if (amountInput) {
      // Format giá trị ban đầu nếu có
      if (amountInput.value) {
        amountInput.value = formatNumber(amountInput.value);
      }

      // Format khi nhập
      amountInput.addEventListener("input", function () {
        this.value = formatNumber(this.value);
      });

      // Loại bỏ dấu phẩy trước khi submit
      amountInput.closest("form").addEventListener("submit", function () {
        amountInput.value = amountInput.value.replace(/,/g, "");
      });
    }
  });
</script>
{% endblock %}
